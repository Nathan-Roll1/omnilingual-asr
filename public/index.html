<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OmniTranscribe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/style.css" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C7RG9YG3VK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-C7RG9YG3VK');
    </script>
  </head>
  <body>
    <div class="grain"></div>

    <div class="shell">
      <aside class="sidebar">
        <div class="sidebar-brand">
          <img class="brand-mark" src="/static/stanford-logo.svg" alt="Stanford logo" />
          <div>
            <h1>OmniTranscribe</h1>
            <p>by Stanford Linguistics</p>
          </div>
        </div>

        <div class="sidebar-upload">
          <div class="sidebar-upload-actions">
            <label class="btn-primary" for="file-input">Upload audio</label>
            <label class="btn-secondary" for="folder-input">Upload folder</label>
          </div>
          <input id="file-input" type="file" accept=".wav,.mp3,.flac,.ogg,.m4a,.zip" multiple />
          <input id="folder-input" type="file" webkitdirectory directory multiple />
          <p class="sidebar-hint">Supports WAV, MP3, FLAC, OGG, M4A, ZIP</p>
          <div class="sidebar-file-list" id="file-list"></div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Library</div>
          <div id="history-list" class="history-list"></div>
        </div>

        <div class="sidebar-cite">
          <button class="cite-btn" id="cite-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9h6V6a3 3 0 00-3-3H6a3 3 0 00-3 3v3a3 3 0 003 3h3" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M15 9h6V6a3 3 0 00-3-3h-3a3 3 0 00-3 3v3a3 3 0 003 3h3" stroke-linecap="round" stroke-linejoin="round" transform="translate(0,6)"/>
            </svg>
            Cite this tool
          </button>
          <div class="cite-box hidden" id="cite-box">
            <div class="cite-label">MLA Citation</div>
            <div class="cite-text" id="cite-text">Roll, Nathan, Lorena Martin Rodriguez, and Dan Jurafsky. <em>OmniTranscribe</em>. Stanford Linguistics, 2025. Web.</div>
            <button class="cite-copy" id="cite-copy">Copy</button>
          </div>
        </div>
      </aside>

      <main class="workspace">
        <header class="workspace-header">
          <div>
            <h2>Transcript Dashboard</h2>
            <p>Click a word to play and edit text or timestamps.</p>
          </div>
          <div class="export-dropdown" id="export-dropdown">
            <button class="btn-secondary" id="export-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Export
              <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="export-menu hidden" id="export-menu">
              <button class="export-option" data-format="eaf">
                <span class="export-format">EAF</span>
                <span class="export-desc">ELAN Annotation Format</span>
              </button>
              <button class="export-option" data-format="textgrid">
                <span class="export-format">TextGrid</span>
                <span class="export-desc">Praat TextGrid</span>
              </button>
              <button class="export-option" data-format="txt">
                <span class="export-format">TXT</span>
                <span class="export-desc">Plain text transcript</span>
              </button>
              <button class="export-option" data-format="srt">
                <span class="export-format">SRT</span>
                <span class="export-desc">Subtitles format</span>
              </button>
              <button class="export-option" data-format="json">
                <span class="export-format">JSON</span>
                <span class="export-desc">Raw transcript data</span>
              </button>
            </div>
          </div>
        </header>

        <section class="drop-zone" id="upload-zone">
          <div class="drop-inner">
            <div class="drop-icon">
              <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 15V3m0 0l-4 4m4-4l4 4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <h3>Drop audio, a folder, or a zip</h3>
              <p>Supports WAV, MP3, FLAC, OGG, M4A and ZIP bundles.</p>
            </div>
          </div>
        </section>

        <section class="progress-section hidden" id="progress-section">
          <div class="progress-steps">
            <div class="progress-step" data-step="0">
              <div class="step-indicator">
                <svg class="step-check hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="step-number">1</span>
              </div>
              <span class="step-label">Uploading</span>
            </div>
            <div class="progress-connector"></div>
            <div class="progress-step" data-step="1">
              <div class="step-indicator">
                <svg class="step-check hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="step-number">2</span>
              </div>
              <span class="step-label">Transcribing</span>
            </div>
            <div class="progress-connector"></div>
            <div class="progress-step" data-step="2">
              <div class="step-indicator">
                <svg class="step-check hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="step-number">3</span>
              </div>
              <span class="step-label">Processing</span>
            </div>
            <div class="progress-connector"></div>
            <div class="progress-step" data-step="3">
              <div class="step-indicator">
                <svg class="step-check hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="step-number">4</span>
              </div>
              <span class="step-label">Complete</span>
            </div>
          </div>
          <div class="progress-bar-track">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
          </div>
          <div class="progress-meta" id="progress-meta"></div>
        </section>

        <section class="status-bar" id="status">
          <div class="status-pulse"></div>
          <span class="status-text"></span>
        </section>

        <!-- Canvas header (shows current file) -->
        <section class="canvas-header hidden" id="canvas-header">
          <div class="canvas-info">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18V5l12-2v13" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="6" cy="18" r="3"/>
              <circle cx="18" cy="16" r="3"/>
            </svg>
            <span class="canvas-name" id="canvas-name"></span>
          </div>
          <div class="canvas-meta" id="canvas-meta"></div>
        </section>

        <!-- Summary section (shown when available) -->
        <section class="transcript-summary hidden" id="transcript-summary">
          <div class="summary-header">
            <h3>Summary</h3>
            <div class="summary-badges">
              <div class="badge-group" id="language-badges"></div>
              <div class="badge-group" id="speaker-badges"></div>
              <div class="badge-group" id="emotion-badges"></div>
            </div>
          </div>
          <div class="summary-content" id="summary-content"></div>
        </section>

        <!-- View controls -->
        <section class="view-controls hidden" id="view-controls">
          <div class="view-toggle">
            <button class="view-btn active" data-view="flow" title="Flow view">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 6h16M4 12h16M4 18h10" stroke-linecap="round"/>
              </svg>
              Flow
            </button>
            <button class="view-btn" data-view="box" title="Box view">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/>
                <rect x="14" y="14" width="7" height="7" rx="1"/>
              </svg>
              Boxes
            </button>
          </div>
          <div class="highlight-selector">
            <label>Highlight by:</label>
            <select id="highlight-mode">
              <option value="chunk">Chunk</option>
              <option value="speaker">Speaker</option>
              <option value="language">Language</option>
              <option value="emotion">Emotion</option>
            </select>
          </div>
        </section>

        <section class="transcript" id="transcript"></section>
      </main>
    </div>

    <!-- Upload Options Modal -->
    <div class="modal-overlay hidden" id="upload-modal">
      <div class="modal">
        <div class="modal-header">
          <h3>Transcription Options</h3>
          <button class="modal-close" id="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="language-select">Language (optional)</label>
            <select id="language-select">
              <option value="">Auto-detect</option>
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="fr">French</option>
              <option value="de">German</option>
              <option value="it">Italian</option>
              <option value="pt">Portuguese</option>
              <option value="ru">Russian</option>
              <option value="zh">Chinese</option>
              <option value="ja">Japanese</option>
              <option value="ko">Korean</option>
              <option value="ar">Arabic</option>
              <option value="hi">Hindi</option>
              <option value="other">Other (specify in audio)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="speaker-count">Number of Speakers (optional)</label>
            <select id="speaker-count">
              <option value="">Auto-detect</option>
              <option value="1">1 speaker</option>
              <option value="2">2 speakers</option>
              <option value="3">3 speakers</option>
              <option value="4">4 speakers</option>
              <option value="5">5 speakers</option>
              <option value="6+">6 or more speakers</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" id="modal-cancel">Cancel</button>
          <button class="btn-primary" id="modal-confirm">Start Transcription</button>
        </div>
      </div>
    </div>

    <!-- Password Modal -->
    <div class="modal-overlay" id="password-modal">
      <div class="modal">
        <div class="modal-header">
          <h3>Authentication Required</h3>
          <button class="modal-close" id="password-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="password-input">Enter Password</label>
            <input type="password" id="password-input" placeholder="Password" autocomplete="off" />
          </div>
          <p id="password-error" class="password-error hidden">Incorrect password. Please try again.</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" id="password-cancel">Cancel</button>
          <button class="btn-primary" id="password-submit">Submit</button>
        </div>
      </div>
    </div>

    <!-- Waveform/Spectrogram Panel (expandable) -->
    <div class="waveform-panel" id="waveform-panel">
      <div class="waveform-header">
        <div class="waveform-tabs">
          <button class="waveform-tab active" data-view="waveform" id="tab-waveform">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 12h2l3-9 4 18 4-9 3 4h4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Waveform
          </button>
          <button class="waveform-tab" data-view="spectrogram" id="tab-spectrogram">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 15h18M3 9h18M9 3v18M15 3v18" opacity="0.3"/>
            </svg>
            Spectrogram
          </button>
        </div>
        <div class="waveform-controls">
          <button class="waveform-ctrl-btn" id="toggle-words" title="Toggle word boundaries">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 7h16M4 12h10M4 17h14" stroke-linecap="round"/>
            </svg>
          </button>
          <button class="waveform-ctrl-btn" id="loop-selection" title="Loop selection (L)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 2l4 4-4 4M3 11V9a4 4 0 014-4h14M7 22l-4-4 4-4M21 13v2a4 4 0 01-4 4H3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="waveform-separator"></div>
          <button class="waveform-ctrl-btn" id="zoom-out" title="Zoom out (-)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35M8 11h6"/>
            </svg>
          </button>
          <button class="waveform-ctrl-btn" id="zoom-in" title="Zoom in (+)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35M11 8v6M8 11h6"/>
            </svg>
          </button>
          <button class="waveform-ctrl-btn" id="waveform-close" title="Close panel">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
        </div>
      </div>
      <!-- Canvas container with all layers -->
      <div class="waveform-canvas-container" id="waveform-split-container">
        <!-- Frequency axis (for spectrogram view) -->
        <div class="waveform-freq-axis" id="waveform-freq-axis"></div>
        <!-- Canvases -->
        <canvas id="waveform-canvas"></canvas>
        <canvas id="spectrogram-canvas"></canvas>
        <!-- Overlays on top of canvases -->
        <div class="waveform-segments" id="waveform-segments"></div>
        <div class="waveform-words" id="waveform-words"></div>
        <div class="waveform-selection" id="waveform-selection"></div>
        <div class="waveform-playhead" id="waveform-playhead"></div>
        <div class="waveform-time-ruler" id="waveform-time-ruler"></div>
        <!-- Cursor info display -->
        <div class="waveform-cursor-info" id="waveform-cursor-info">
          <span class="cursor-time" id="cursor-time">--:--</span>
          <span class="cursor-freq" id="cursor-freq">-- Hz</span>
        </div>
      </div>
    </div>

    <!-- IPA Character Picker -->
    <div class="ipa-picker hidden" id="ipa-picker">
      <div class="ipa-picker-header">
        <span>IPA Characters</span>
        <button class="ipa-picker-close" id="ipa-picker-close">&times;</button>
      </div>
      <div class="ipa-picker-tabs">
        <button class="ipa-tab active" data-category="consonants">Consonants</button>
        <button class="ipa-tab" data-category="vowels">Vowels</button>
        <button class="ipa-tab" data-category="diacritics">Diacritics</button>
        <button class="ipa-tab" data-category="tones">Tones</button>
      </div>
      <div class="ipa-picker-grid" id="ipa-grid"></div>
    </div>

    <footer class="player-bar" id="player-bar">
      <div class="player-inner">
        <button class="player-btn" id="play-pause" aria-label="Play audio" aria-pressed="false">
          <svg class="icon-play" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg class="icon-pause hidden" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <rect x="6" y="4" width="4" height="16"/>
            <rect x="14" y="4" width="4" height="16"/>
          </svg>
        </button>
        <button class="player-btn" id="skip-back" title="Skip back 5 seconds" aria-label="Skip back 5 seconds">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
            <text x="12" y="14" text-anchor="middle" font-size="6" font-weight="bold" fill="currentColor">5</text>
          </svg>
        </button>
        <div class="player-time" id="current-time" aria-label="Current time">0:00</div>
        <div class="player-progress" role="slider" aria-label="Audio position" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="progress-bg">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <input type="range" class="progress-input" id="progress-input" min="0" max="100" value="0" aria-hidden="true" />
        </div>
        <div class="player-time" id="duration" aria-label="Total duration">0:00</div>
        <button class="player-btn" id="skip-forward" title="Skip forward 5 seconds" aria-label="Skip forward 5 seconds">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/>
            <text x="12" y="14" text-anchor="middle" font-size="6" font-weight="bold" fill="currentColor">5</text>
          </svg>
        </button>
        <div class="player-speed" id="speed-control">
          <button class="speed-btn" id="speed-btn" title="Playback speed" aria-label="Playback speed: 1x">
            <span id="speed-label">1x</span>
          </button>
          <div class="speed-menu hidden" id="speed-menu" role="menu">
            <button class="speed-option" data-speed="0.5" role="menuitem">0.5x</button>
            <button class="speed-option" data-speed="0.75" role="menuitem">0.75x</button>
            <button class="speed-option active" data-speed="1" role="menuitem">1x</button>
            <button class="speed-option" data-speed="1.25" role="menuitem">1.25x</button>
            <button class="speed-option" data-speed="1.5" role="menuitem">1.5x</button>
            <button class="speed-option" data-speed="2" role="menuitem">2x</button>
          </div>
        </div>
        <button class="player-btn" id="toggle-waveform" title="Toggle waveform/spectrogram" aria-label="Toggle waveform panel" aria-pressed="false">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M2 12h2l3-9 4 18 4-9 3 4h4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <audio id="audio"></audio>
      </div>
    </footer>

    <!-- Keyboard shortcuts help modal -->
    <div class="shortcuts-modal hidden" id="shortcuts-modal">
      <div class="shortcuts-content">
        <div class="shortcuts-header">
          <h3>Keyboard Shortcuts</h3>
          <button class="modal-close" id="shortcuts-close">&times;</button>
        </div>
        <div class="shortcuts-body">
          <div class="shortcuts-group">
            <h4>Playback</h4>
            <div class="shortcut"><kbd>Space</kbd><span>Play/Pause</span></div>
            <div class="shortcut"><kbd>←</kbd><span>Skip back 5s</span></div>
            <div class="shortcut"><kbd>→</kbd><span>Skip forward 5s</span></div>
            <div class="shortcut"><kbd>Shift</kbd>+<kbd>←</kbd><span>Skip back 10s</span></div>
            <div class="shortcut"><kbd>Shift</kbd>+<kbd>→</kbd><span>Skip forward 10s</span></div>
            <div class="shortcut"><kbd>[</kbd><span>Slow down</span></div>
            <div class="shortcut"><kbd>]</kbd><span>Speed up</span></div>
            <div class="shortcut"><kbd>L</kbd><span>Loop selection</span></div>
            <div class="shortcut"><kbd>P</kbd><span>Play selection</span></div>
          </div>
          <div class="shortcuts-group">
            <h4>Navigation</h4>
            <div class="shortcut"><kbd>↑</kbd><span>Previous segment</span></div>
            <div class="shortcut"><kbd>↓</kbd><span>Next segment</span></div>
            <div class="shortcut"><kbd>Tab</kbd><span>Next word</span></div>
            <div class="shortcut"><kbd>Shift</kbd>+<kbd>Tab</kbd><span>Previous word</span></div>
            <div class="shortcut"><kbd>Home</kbd><span>Jump to start</span></div>
            <div class="shortcut"><kbd>End</kbd><span>Jump to end</span></div>
          </div>
          <div class="shortcuts-group">
            <h4>Editing</h4>
            <div class="shortcut"><kbd>E</kbd><span>Edit selected word</span></div>
            <div class="shortcut"><kbd>Enter</kbd><span>Confirm edit</span></div>
            <div class="shortcut"><kbd>Esc</kbd><span>Cancel edit</span></div>
            <div class="shortcut"><kbd>T</kbd><span>Edit timestamps</span></div>
            <div class="shortcut"><kbd>I</kbd><span>Open IPA picker</span></div>
          </div>
          <div class="shortcuts-group">
            <h4>View</h4>
            <div class="shortcut"><kbd>W</kbd><span>Toggle waveform panel</span></div>
            <div class="shortcut"><kbd>1</kbd><span>Waveform view</span></div>
            <div class="shortcut"><kbd>2</kbd><span>Spectrogram view</span></div>
            <div class="shortcut"><kbd>B</kbd><span>Toggle word boundaries</span></div>
            <div class="shortcut"><kbd>+</kbd><span>Zoom in</span></div>
            <div class="shortcut"><kbd>-</kbd><span>Zoom out</span></div>
            <div class="shortcut"><kbd>?</kbd><span>Show shortcuts</span></div>
          </div>
        </div>
      </div>
    </div>

    <script src="/static/app.js"></script>
  </body>
</html>
